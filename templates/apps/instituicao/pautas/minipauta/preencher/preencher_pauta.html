
{% extends 'base/_dashboard_.html' %}
{% load custom_filters %}
{% block content %}
<div class="container mt-4">
  <h4>Preencher Mini Pauta</h4>

  <!-- Filtro -->
  <form method="get" class="row mb-4">
    <div class="col-md-4">
      <label for="turma">Turma</label>
      <select name="turma" id="turma" class="form-control" required>
        <option value="">-- Selecione a turma --</option>
        {% for turma in turmas %}
          <option value="{{ turma.id }}" {% if turma.id|stringformat:"s" == turma_id %}selected{% endif %}>
            {{ turma.nome }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label for="disciplina">Disciplina</label>
      <select name="disciplina" id="disciplina" class="form-control" required>
        <option value="">-- Selecione a disciplina --</option>
        {% for disciplina in disciplinas %}
          <option value="{{ disciplina.id }}" {% if disciplina.id|stringformat:"s" == disciplina_id %}selected{% endif %}>
            {{ disciplina.nome }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label for="trimestre">Trimestre</label>
      <select name="trimestre" id="trimestre" class="form-control" required>
        <option value="">-- Trimestre --</option>
        <option value="1" {% if trimestre == '1' %}selected{% endif %}>1ยบ Trimestre</option>
        <option value="2" {% if trimestre == '2' %}selected{% endif %}>2ยบ Trimestre</option>
        <option value="3" {% if trimestre == '3' %}selected{% endif %}>3ยบ Trimestre</option>
      </select>
    </div>
    <div class="col-12 mt-3 text-end">
      <button class="btn btn-primary">Filtrar</button>
    </div>
  </form>

  {% if alunos %}
  <form id="form-mini-pauta">
    <table class="table table-bordered table-sm text-center align-middle">
      <thead class="table-light">
        <tr>
          <th>Aluno</th>
          <th>AV1</th>
          <th>AV2</th>
          <th>AV3</th>
          <th>AV4</th>
          <th>MAC</th>
          <th>NPP</th>
          <th>NPT</th>
          <th>MT</th>
          <th>Exame</th>
          <th>MF</th>
          <th>Resultado</th>
        </tr>
      </thead>
      <tbody>
        {% for aluno in alunos %}
        {% with pauta=pauta_dict|get_item:aluno.id %}
        <tr>
          <td class="text-start">{{ aluno.nome }}</td>
          {% for i in "1234" %}
          <td>
            <input type="number" min="0" max="20" step="0.1" class="form-control form-control-sm nota-input"
              name="av{{i}}" data-id="{{ aluno.id }}"
              value="{{ pauta|get_attr:"av"|add:i|default_if_none:0 }}">
          </td>
          {% endfor %}
          <td><input type="number" name="mac" class="form-control form-control-sm bg-light" data-id="{{ aluno.id }}"
              value="{{ pauta.mac|default_if_none:0 }}" readonly></td>
          <td><input type="number" name="npp" class="form-control form-control-sm nota-input" data-id="{{ aluno.id }}"
              value="{{ pauta.npp|default_if_none:0 }}"></td>
          <td><input type="number" name="npt" class="form-control form-control-sm nota-input" data-id="{{ aluno.id }}"
              value="{{ pauta.npt|default_if_none:0 }}"></td>
          <td><input type="number" name="mt" class="form-control form-control-sm bg-light" data-id="{{ aluno.id }}"
              value="{{ pauta.mt|default_if_none:0 }}" readonly></td>
          <td><input type="number" name="exame" class="form-control form-control-sm nota-input" data-id="{{ aluno.id }}"
              value="{{ pauta.exame|default_if_none:0 }}"></td>
          <td><input type="number" name="mf" class="form-control form-control-sm bg-light" data-id="{{ aluno.id }}"
              value="{{ pauta.mf|default_if_none:0 }}" readonly></td>
          <td>
            <span id="status_{{ aluno.id }}"></span>
          </td>
        </tr>
        {% endwith %}
        {% endfor %}
      </tbody>
    </table>
  </form>
  
  <input type="hidden" id="disciplina_id" value="{{ disciplina_id }}">
  <input type="hidden" id="trimestre" value="{{ trimestre }}">
  
{% else %}
  <div class="alert alert-warning">Selecione uma turma, disciplina e trimestre para preencher a Mini Pauta.</div>
{% endif %}


<!-- Hidden -->
<input type="hidden" id="disciplina_id" value="{{ disciplina_id }}">
<input type="hidden" id="trimestre" value="{{ trimestre }}">

</div>

<!-- Hidden para JS -->
<input type="hidden" id="disciplina_id" value="{{ disciplina_id }}">
<input type="hidden" id="trimestre" value="{{ trimestre }}">

{% endblock %}




























